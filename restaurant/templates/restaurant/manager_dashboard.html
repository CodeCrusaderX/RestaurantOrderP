{% extends 'restaurant/base.html' %}

{% block content %}
<div class="navbar" style="background: #212121;">
    <div class="brand">ðŸ“Š Manager Dashboard</div>
    <div style="display: flex; gap: 15px;">
        <a href="{% url 'menu_manage' %}" class="btn" style="background: #333; font-size: 0.9rem;">Manage Menu</a>
        <a href="{% url 'logout' %}" class="btn" style="background: #D32F2F; font-size: 0.9rem;">Logout</a>
    </div>
</div>

<div class="container">
    <div class="card" style="margin-bottom: 20px;">
        <h2 style="margin-bottom: 20px;">Live Table Status</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;">
            {% for t in table_stats %}
            <div
                style="background: {% if t.is_occupied %}#333{% else %}#1B5E20{% endif %}; padding: 15px; border-radius: 8px; text-align: center;">
                <h3 style="margin-bottom: 5px;">Table {{ t.number }}</h3>
                {% if t.is_occupied %}
                <span style="color: #FF5722;">Occupied</span>
                <div style="font-size: 0.9rem; margin-top: 5px; color: #aaa;">
                    Serviced by: <strong style="color: white;">{{ t.waiter|default:"Unknown" }}</strong>
                </div>
                <a href="{% url 'force_clear_table' t.id %}" class="btn"
                    style="margin-top: 10px; padding: 5px 10px; font-size: 0.8rem; background: #D32F2F; color: white; display: inline-block;">Force
                    Clear</a>
                {% else %}
                <span style="color: var(--success-color);">Vacant</span>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="card" style="text-align: center; padding: 40px;">
        <h3 style="color: var(--secondary-text); margin-bottom: 10px;">Total Revenue</h3>
        <h1 style="color: var(--success-color); font-size: 3rem;">â‚¹{{ revenue }}</h1>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div class="card">
            <h2 style="margin-bottom: 20px;">Top Items</h2>
            {% for item in popular_items %}
            <div style="display: flex; justify-content: space-between; border-bottom: 1px solid #333; padding: 10px 0;">
                <span>{{ item.name }}</span>
                <span style="color: var(--primary-color);">{{ item.total_sold|default:"0" }} sold</span>
            </div>
            {% endfor %}
        </div>

        <div class="card">
            <h2 style="margin-bottom: 20px;">Recent Activity</h2>
            {% for order in recent_orders %}
            <div style="margin-bottom: 10px; font-size: 0.9rem;">
                <span class="status-badge status-{{ order.is_active|yesno:'preparing,delivered' }}">
                    {% if order.is_active %}Active{% else %}Closed{% endif %}
                </span>
                Table {{ order.table.number }} - â‚¹{{ order.total_amount }}
            </div>
            {% endfor %}
        </div>
    </div>
</div>
<script>
    setTimeout(() => {
        window.location.reload();
    }, 10000);
</script>
{% endblock %}