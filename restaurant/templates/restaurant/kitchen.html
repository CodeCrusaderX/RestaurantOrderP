{% extends 'restaurant/base.html' %}

{% block content %}
<div class="navbar" style="background: #000;">
    <div class="brand" style="color: #FFD600;">ğŸ‘¨â€ğŸ³ Kitchen Display System</div>
</div>

<div class="container">
    <div class="kitchen-grid">
        {% for order in orders %}
        <div class="card order-card">
            <div
                style="display: flex; justify-content: space-between; border-bottom: 2px solid #555; padding-bottom: 10px; margin-bottom: 10px;">
                <h2>Table {{ order.table.number }}</h2>
                <span>#{{ order.id }}</span>
            </div>

            {% for item in order.items.all %}
            {% if item.status != 'delivered' %}
            <div class="kitchen-item" id="item-{{ item.id }}">
                <div style="flex: 1;">
                    <div style="font-weight: bold; font-size: 1.1rem;">{{ item.item.name }}</div>
                    <div style="color: #aaa;">Qty: {{ item.quantity }}</div>
                </div>

                <div>
                    {% if item.status == 'queued' %}
                    <button class="btn" style="background: #2196F3; color: white; padding: 5px 10px;"
                        onclick="updateStatus({{ item.id }}, 'preparing')">Start</button>
                    {% elif item.status == 'preparing' %}
                    <button class="btn" style="background: #FFD600; color: black; padding: 5px 10px;"
                        onclick="updateStatus({{ item.id }}, 'prepared')">Ready</button>
                    {% elif item.status == 'prepared' %}
                    <div class="status-badge status-prepared">READY</div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% endfor %}
    </div>
</div>

<script>
    function updateStatus(itemId, status) {
        fetch("{% url 'update_order_status' %}", {
            method: 'POST',
            body: JSON.stringify({ item_id: itemId, status: status }),
            headers: { 'X-CSRFToken': '{{ csrf_token }}' }
        }).then(() => {
            window.location.reload();
        });
    }

    // Auto refresh
    setTimeout(() => {
        window.location.reload();
    }, 10000);
</script>
{% endblock %}